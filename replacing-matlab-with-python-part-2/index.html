<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Replacing MATLAB with Python - Part 2: Formatting subplots and indexing data</title>
    <link rel="stylesheet" href="../assets/built/screen.css@v=6613460358.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Mulish:ital,wght@0,400;0,700;0,800;1,400;1,700&display=swap">

    <script>
        if (localStorage.getItem('alto_dark') == 'true') {
            document.documentElement.classList.add('dark-mode');
        }
    </script>

    <meta name="description" content="I used Python to complete the first part of the task from my previous post in the series. I learned about formatting plots and indexing Pandas dataframes." />
    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="Making stuff after office hours" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Replacing MATLAB with Python - Part 2: Formatting subplots and indexing data" />
    <meta property="og:description" content="I used Python to complete the first part of the task from my previous post in the series. I learned about formatting plots and indexing Pandas dataframes." />
    <meta property="og:url" content="http://localhost:2368/replacing-matlab-with-python-part-2/" />
    <meta property="og:image" content="https://images.unsplash.com/photo-1551431524-06b3c82d31ca?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxrZXlib2FyZHxlbnwwfHx8fDE2NjM1NjQ5NDc&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000" />
    <meta property="article:published_time" content="2022-09-19T05:18:44.000Z" />
    <meta property="article:modified_time" content="2022-09-19T05:45:24.000Z" />
    <meta property="article:tag" content="Data" />
    <meta property="article:tag" content="Engineering" />
    <meta property="article:tag" content="MATLAB" />
    <meta property="article:tag" content="Python" />
    <meta property="article:tag" content="ReplacingMATLABwithPython" />
    <meta property="article:tag" content="SignalProcessing" />
    
    <meta property="article:publisher" content="https://www.facebook.com/ghost" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Replacing MATLAB with Python - Part 2: Formatting subplots and indexing data" />
    <meta name="twitter:description" content="I used Python to complete the first part of the task from my previous post in the series. I learned about formatting plots and indexing Pandas dataframes." />
    <meta name="twitter:url" content="http://localhost:2368/replacing-matlab-with-python-part-2/" />
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1551431524-06b3c82d31ca?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxrZXlib2FyZHxlbnwwfHx8fDE2NjM1NjQ5NDc&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Luis Medina" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Data, Engineering, MATLAB, Python, ReplacingMATLABwithPython, SignalProcessing" />
    <meta name="twitter:site" content="@ghost" />
    <meta property="og:image:width" content="2000" />
    <meta property="og:image:height" content="1331" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Making stuff after office hours",
        "url": "http://localhost:2368/",
        "logo": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Luis Medina",
        "image": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/content/images/2022/07/IMG_20210703_160904-1.jpg",
            "width": 1475,
            "height": 1474
        },
        "url": "http://localhost:2368/author/luis/",
        "sameAs": []
    },
    "headline": "Replacing MATLAB with Python - Part 2: Formatting subplots and indexing data",
    "url": "http://localhost:2368/replacing-matlab-with-python-part-2/",
    "datePublished": "2022-09-19T05:18:44.000Z",
    "dateModified": "2022-09-19T05:45:24.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://images.unsplash.com/photo-1551431524-06b3c82d31ca?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxrZXlib2FyZHxlbnwwfHx8fDE2NjM1NjQ5NDc&ixlib=rb-1.2.1&q=80&w=2000",
        "width": 2000,
        "height": 1331
    },
    "keywords": "Data, Engineering, MATLAB, Python, ReplacingMATLABwithPython, SignalProcessing",
    "description": "I used Python to complete the first part of the task from my previous post in the series. I learned about formatting plots and indexing Pandas dataframes.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.2" />
    <link rel="alternate" type="application/rss+xml" title="Making stuff after office hours" href="../rss/index.html" />
    <script defer src="https://unpkg.com/@tryghost/portal@~2.2.0/umd/portal.min.js" data-ghost="http://localhost:2368/" data-key="301bf1d34b7e435e3fcf462aa7" data-api="http://localhost:2368/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style><style>:root {--ghost-accent-color: #19809a;}</style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-tomorrow.min.css" integrity="sha512-vswe+cgvic/XBoF1OcM/TeJ2FW0OofqAVdCZiEYkd6dwGXthvkSFWOoGGJgS2CW70VK5dQM5Oh+7ne47s74VTg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body class="post-template tag-data tag-engineering tag-matlab tag-python tag-replacingmatlabwithpython tag-signalprocessing has-serif-title">
    <div class="site">
        <header class="site-header container">
    <div class="navbar">
        <div class="navbar-left">
            <div class="burger hidden-lg hidden-xl"></div>
            <a class="logo" href="../index.html">
        <span class="logo-text">Making stuff after office hours</span>
</a>            <div class="sep hidden-xs hidden-sm hidden-sm"></div>
                <nav class="main-menu hidden-xs hidden-sm hidden-md">
                    <ul class="nav-list u-plain-list">
        <li class="menu-item menu-item-home"><a class="menu-item-link"
                href="../index.html">Home</a></li>
        <li class="menu-item menu-item-about"><a class="menu-item-link"
                href="../about/index.html">About</a></li>
</ul>
                </nav>
        </div>
        <div class="navbar-right">
            <div class="toggle-track">
                <div class="toggle-moon"><i class="icon icon-brightness-2"></i></div>
                <div class="toggle-sun"><i class="icon icon-white-balance-sunny"></i></div>
                <div class="toggle-thumb"></div>
            </div>
        </div>
    </div>
</header>        <div class="site-content">
            
<div class="content-area">
    <main class="site-main">
            <article class="post tag-data tag-engineering tag-matlab tag-python tag-replacingmatlabwithpython tag-signalprocessing single-post">
                <header class="post-header big-title container medium">
        <h1 class="post-title">Replacing MATLAB with Python - Part 2: Formatting subplots and indexing data</h1>
            <div class="post-meta">
                <span class="post-meta-item post-meta-date">
                    <time datetime="2022-09-19">Sep 19, 2022</time>
                </span>
                <span class="post-meta-item post-meta-length">
                    10 min read
                </span>
                    <span class="post-meta-item post-meta-tags">
                        <a class="post-tag post-tag-data" href="../tag/data/index.html"
                                title="Data">Data</a><a class="post-tag post-tag-engineering" href="../tag/engineering/index.html"
                                title="Engineering">Engineering</a><a class="post-tag post-tag-matlab" href="../tag/matlab/index.html"
                                title="MATLAB">MATLAB</a><a class="post-tag post-tag-python" href="../tag/python/index.html"
                                title="Python">Python</a><a class="post-tag post-tag-replacingmatlabwithpython" href="../tag/replacingmatlabwithpython/index.html"
                                title="ReplacingMATLABwithPython">ReplacingMATLABwithPython</a><a class="post-tag post-tag-signalprocessing" href="../tag/signalprocessing/index.html"
                                title="SignalProcessing">SignalProcessing</a>
                    </span>
            </div>
</header>                    <figure class="post-media container large">
        <div class="u-placeholder horizontal">
            <a class="post-image-link" href="index.html">
                <img class="post-image lazyload u-object-fit"

                    data-srcset="https://images.unsplash.com/photo-1551431524-06b3c82d31ca?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxrZXlib2FyZHxlbnwwfHx8fDE2NjM1NjQ5NDc&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 400w, https://images.unsplash.com/photo-1551431524-06b3c82d31ca?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxrZXlib2FyZHxlbnwwfHx8fDE2NjM1NjQ5NDc&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 750w, https://images.unsplash.com/photo-1551431524-06b3c82d31ca?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxrZXlib2FyZHxlbnwwfHx8fDE2NjM1NjQ5NDc&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 960w, https://images.unsplash.com/photo-1551431524-06b3c82d31ca?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxrZXlib2FyZHxlbnwwfHx8fDE2NjM1NjQ5NDc&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 1140w, https://images.unsplash.com/photo-1551431524-06b3c82d31ca?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxrZXlib2FyZHxlbnwwfHx8fDE2NjM1NjQ5NDc&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 1920w"
                    data-sizes="auto" src="https://images.unsplash.com/photo-1551431524-06b3c82d31ca?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxrZXlib2FyZHxlbnwwfHx8fDE2NjM1NjQ5NDc&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000"
                    srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
                     alt="Replacing MATLAB with Python - Part 2: Formatting subplots and indexing data">
            </a>
        </div>

                <figcaption>Photo by <a href="https://unsplash.com/@cbben?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit">Troy Chen</a> / <a href="https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit">Unsplash</a></figcaption>
    </figure>
                <div class="post-content gh-content kg-canvas">
                    <p>A couple of weeks ago, I published the second entry of the <strong><a href="https://makerluis.com/replacing-matlab-with-python-part-1/index.html">Replacing MATLAB with Python</a></strong> series I started in August. I am sharing examples of how to do that, with some comments about the problems I find while learning Python.</p><p>In the <a href="https://makerluis.com/using-matlab-and-statistics-to-analyze-raw-vehicle-data/index.html">previous post</a> of the series, I didn’t really share any Python code, though. It was an example of how I would use MATLAB to get information from raw data collected from a race car’s CAN bus.</p><p>In this entry,  I’m using Python to do the first part of the task: visualize the signals we have by creating a figure with subplots, filter the raw acceleration data, compute the vehicle speed for the two drivers, and compare it. It took me more than twice the time to do it in Python than it did with MATLAB. That’s mainly because I have been using MATLAB for many years now, and I am just getting used to Python. Especially when formatting plots, there are several things to handle differently from Matlab,  or even from one Python library to another.</p><p>As always, bear in mind that this is not intended to be a Python course, but rather a series of practical examples.</p><p>Alright, to the code!</p><hr><h2 id="importing-the-data">Importing the data</h2><p>I’m following the same workflow that I used for the <a href="https://makerluis.com/using-matlab-and-statistics-to-analyze-raw-vehicle-data/index.html">MATLAB version of this</a>, where I also provided more context on what we have. Short story, we want to compare the performance of two drivers, and we have the car data for each one in separate CSV files.</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://drive.google.com/drive/folders/16f2fLXelTBtj9vFxSSiNUQrmIUy3IEPX?usp&#x3D;sharing"><div class="kg-bookmark-content"><div class="kg-bookmark-title">RaceCar data - Google Drive</div><div class="kg-bookmark-description"></div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png" alt=""><span class="kg-bookmark-author">Google Drive</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://drive-thirdparty.googleusercontent.com/128/type/text/csv" alt=""></div></a></figure><p>This is the code I wrote to start with. We’ve already seen how to load information from CSV files and use <a href="https://pandas.pydata.org/">Pandas</a> to handle our data.</p><p>When using Python, the first thing we do is import the libraries we are going to use. We don’t necessarily have to put the imports on top of everything, but it’s in general good practice.</p><p></p><pre><code class="language-python">#%% Import libraries
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

#%% Load data from CSV files

df1 = pd.read_csv('driver1.csv')
print(df1.columns)

df2 = pd.read_csv('driver2.csv')
print(df2.columns)

#%% Define constants
gear_ratio = 16     # Transmission gear ratio
r = 0.263           # Wheel radius [m]

&gt;&gt; Index(['Time_s', 'BrakeFront', 'AccX', 'spd_rpmFL', 'spd_rpmFR', 'spd_rpmRL',
       'spd_rpmRR'],
        dtype='object')
</code></pre><p>All good! We have a unique time base and 6 signals in each file. But we have to make sure they are consistent and can be used together. This is why the next thing I did in MATLAB was plotting the variables. </p><p>When I tried to do the same thing using Python, it took me a while. More than I am comfortable admitting. I was stubbornly trying to get the exact same look I got with the default settings in MATLAB and, obviously, that required a lot of formatting. At some point I got it, but the number of trials with format options was just not worth it. Just look at the <code>plt.rcParams.update</code> call at the bottom of the next code snippet! My advice: if you are replacing MATLAB with Python, don’t try to get exactly the same look on your charts unless there is a real need for that- in my case, there wasn’t.</p><p></p><pre><code class="language-python"># If needed, reset plot parameters from any previous plot
# plt.rcParams.update(plt.rcParamsDefault)

fig = plt.figure(figsize = (1200/300, 600/300), dpi = 300)

c = 1 # subplot counter
for col in df1.columns[1:]:
    ax = plt.subplot(3, 3, c)
    ax.plot(df1['Time_s'], df1[col], label = '1', linewidth = 0.2)
    ax.plot(df2['Time_s'], df2[col], label = '2', linewidth = 0.2)
    leg = ax.legend(edgecolor = 'black',
                    borderpad=.5, borderaxespad = .5,
                    fontsize = 3, fancybox = False,
                    loc = 'upper right')
    plt.xlabel('Time [s]', fontsize = 3.5)
    plt.title( col, fontweight="bold", y = 1.05, fontsize = 3.5)
    leg.get_frame().set_linewidth(.1)    
    c = c + 1

plt.rcParams.update({'axes.grid': False,
                    'xtick.labelsize': 3,
                    'ytick.labelsize': 3,
                    'axes.labelpad': 1.0,
                    'axes.labelsize': 3.5,
                    'axes.linewidth': 0.5,
                    'ytick.major.pad': 1,
                    'ytick.minor.left': False,
                    'xtick.minor.bottom': False,
                    'ytick.major.size': 1,
                    'ytick.major.width': .2,
                    'xtick.major.pad': 1,
                    'xtick.major.size': 1,
                    'xtick.major.width': .2})

fig.tight_layout()

fig.subplots_adjust(
    top=0.92,
    bottom=0.1,
    left=0.05,
    right=0.98,
    hspace=0.6,
    wspace=0.2
)

fig
</code></pre><figure class="kg-card kg-image-card kg-card-hascaption"><img src="../content/images/2022/09/data_subplots_Python_Pyplot.jpeg" class="kg-image" alt="Plot of the time-series data stored in the CSV files. I didn’t manage to get the exact look of the MATLAB plot. But that’s OK!" loading="lazy" width="2000" height="693" srcset="../content/images/size/w600/2022/09/data_subplots_Python_Pyplot.jpeg 600w, ../content/images/size/w1000/2022/09/data_subplots_Python_Pyplot.jpeg 1000w, ../content/images/size/w1600/2022/09/data_subplots_Python_Pyplot.jpeg 1600w, ../content/images/size/w2400/2022/09/data_subplots_Python_Pyplot.jpeg 2400w" sizes="(min-width: 720px) 720px"><figcaption>Plot of the time-series data stored in the CSV files. I didn’t manage to get the exact look of the MATLAB plot. But that’s OK!</figcaption></figure><p>Some of the useful resources I found online to learn about formatting are: first of all, Matplotlib's official <a href="https://matplotlib.org/stable/tutorials/introductory/customizing.html">documentation</a>. Second, the countless number of sites with Python tutorials online - just googled my questions and found good answers in the first page of results. Third, previously-answered questions on <a href="https://stackoverflow.com/">stackoverflow</a>.</p><hr><p>Something nice about Python is that we are able to iterate directly through the columns of our dataframe, instead of creating an index and then slicing the dataframe by column position. By doing it this way, I just needed to make a counter to move to the next plot, and the data was selected from the current column. The results are not identical to the ones I got in MATLAB, but that’s OK.</p><p>All this additional formatting is needed only if you are using the relatively low-level library <a href="https://matplotlib.org/stable/tutorials/introductory/pyplot.html#">Pyplot</a> and you want to get some really specific format. If you loosen the format a bit and open up to other options - like <a href="https://seaborn.pydata.org/">Seaborn</a> for example - you can actually get away with very little code to get some impressive plots. Or, if you need to make interactive plots, you could use <a href="https://plotly.com/graphing-libraries/">Plotly</a>, like I did when visualizing <a href="https://makerluis.com/that-s-it-i-am-getting-a-more-reliable-3d-printer/index.html">how warped the bed of my 3D printer was</a>. I’ll show another example next, when we compare the speeds of the two drivers.</p><p>Fine, we can make plots without stressing too much about the format and live with it.</p><p>Let’s move on.</p><h2 id="filtering-acceleration-data">Filtering acceleration data</h2><p>As in the MATLAB example, I used a digital filter to smooth the acceleration signals. I’m filtering only those because they are the only ones containing raw data from sensors. Here’s what the raw acceleration data looks like when compared against the filtered one:</p><figure class="kg-card kg-image-card"><img src="../content/images/2022/09/raw_vs_filtered_acc.jpeg" class="kg-image" alt loading="lazy" width="1200" height="400" srcset="../content/images/size/w600/2022/09/raw_vs_filtered_acc.jpeg 600w, ../content/images/size/w1000/2022/09/raw_vs_filtered_acc.jpeg 1000w, ../content/images/2022/09/raw_vs_filtered_acc.jpeg 1200w" sizes="(min-width: 720px) 720px"></figure><p></p><p>The code I used for doing this is quite simple:</p><pre><code class="language-python"># Correct and filter longitudinal acceleration data

# Compute the sum of the in-wheel motor speeds
df1['SumSpeeds'] = df1.iloc[:,3:].sum(axis=1)
df2['SumSpeeds'] = df2.iloc[:,3:].sum(axis=1)

# Remove the DC offset from the raw acceleration signals
df1['AccX_NoOffs'] = df1['AccX'] - df1[df1['SumSpeeds'] == 0]['AccX'].median()
df2['AccX_NoOffs'] = df2['AccX'] - df2[df2['SumSpeeds'] == 0]['AccX'].median()

# Filter the corrected signals
from scipy.signal import savgol_filter

df1.AccX = savgol_filter(df1.AccX_NoOffs, 101, 3)
df2.AccX = savgol_filter(df2.AccX_NoOffs, 101, 3)

# reset figure parameters if previously changed
#plt.rcParams.update(plt.rcParamsDefault) 

# Compare raw acceleration vs filtered
fig = plt.figure(figsize = (1200/300, 400/300), dpi=300)
plt.plot(df1.Time_s, df1.AccX_NoOffs, label = 'Raw (removed DC offset)', linewidth = .5)
plt.plot(df1.Time_s, df1.AccX, label = 'Filtered', linewidth = 1)
plt.xlabel('Time [s]')
plt.ylabel("Acceleration [G-units]")
plt.xlim(600, 650)

leg = plt.legend(fancybox = False, 
                edgecolor = 'inherit', fontsize = 4,
                loc = 'upper right')

plt.title('Raw vs Filtered Longitudinal Acceleration')

plt.rcParams.update({'font.size': 5,
                    'axes.grid': True,
                    'axes.grid.which': 'both',
                    'xtick.minor.visible': True,
                    'ytick.minor.visible': True,
                    'grid.linewidth': 0.2,
                    'lines.linewidth': 0.2})

# Display figure
plt.tight_layout()
fig
</code></pre><p>Implementing the same type of filter as in MATLAB just requires an additional library import. But it is free :). One thing to note is that the input arguments for the Python version <code>savgol_filter(data_array, window_size, poly_order)</code> are swapped with respect to MATLAB’s (recall I used <code>sgolayfilt(data_array, poly_order, window_size)</code>  in the previous post).</p><p>One thing many people like about MATLAB (including me) is its documentation. It’s very good! If you need to know something, you type either <code>help</code> or <code>doc</code>  if you want more details, and get the information right there. With Python, you can do something similar using <code>print(&lt;library,object or function&gt;.__doc___)</code> or simply <code>help(&lt;library,object or function&gt;)</code> .</p><p>Unfortunately, the official documentation for many Python functions is not as detailed as the MATLAB counterpart. For instance, compare the <a href="https://it.mathworks.com/help/signal/ref/sgolayfilt.html">MATLAB</a> and <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.savgol_filter.html">Python (Scypi)</a> official documentation for the filter we used. The former is much clearer. This can be a big thing for many people wanting to learn Python coming from MATLAB, but there is a way to go around it! There are a lot more tutorials online about Python than there are for MATLAB. You just have to embrace the power of <strong>googling</strong>, and lose the fear of sites like <a href="https://stackoverflow.com/">stackoverflow</a>. For example, I found <a href="https://nirpyresearch.com/savitzky-golay-smoothing-method/">this great article</a> about the filter we are using. Additionally, the best thing to do is check some <a href="https://www.ece.rutgers.edu/~orfanidi/intro2sp/">Signal Processing book</a> to learn more about digital filters.</p><p>Ok! I am deviating from the point of this article. Going back to the code examples.</p><h2 id="finding-the-vehicle-speed-indexing-dataframes">Finding the vehicle speed: indexing dataframes</h2><p>As I <a href="https://makerluis.com/using-matlab-and-statistics-to-analyze-raw-vehicle-data/index.html#estimating-the-vehicle-speeds">mentioned</a> in the MATLAB example, we can estimate the vehicle speed using the information from the speeds of the four in-wheel motors. We just need to treat differently the cases in which the vehicle was accelerating and those in which it was braking. To do this, we'l need to index (slice) the dataframe based in conditions. See how I did that in the code below:</p><p></p><pre><code class="language-python">import timeit

%%timeit

df1['Vehicle Speed'] = 0
df2['Vehicle Speed'] = 0

# Estimated vehicle speeds when braking (AccX &lt; = 0)
df1.loc[df1['AccX'] &lt;= 0, 'Vehicle Speed'] =  df1.loc[df1['AccX'] &lt;= 0,
                                            ('spd_rpmFL','spd_rpmFR','spd_rpmRL','spd_rpmRR')].max(axis=1)*np.pi/30*r/gear_ratio*3.6
df2.loc[df2['AccX'] &lt;= 0, 'Vehicle Speed'] =  df2.loc[df2['AccX'] &lt;= 0,
                                            ('spd_rpmFL','spd_rpmFR','spd_rpmRL','spd_rpmRR')].max(axis=1)*np.pi/30*r/gear_ratio*3.6

# Estimated vehicle speeds when accelerating (AccX &gt; 0)
df1.loc[df1['AccX'] &gt; 0, 'Vehicle Speed'] =  df1.loc[df1['AccX'] &gt; 0,
                                            ('spd_rpmFL','spd_rpmFR','spd_rpmRL','spd_rpmRR')].min(axis=1)*np.pi/30*r/gear_ratio*3.6
df2.loc[df2['AccX'] &gt; 0, 'Vehicle Speed'] =  df2.loc[df2['AccX'] &gt; 0,
                                            ('spd_rpmFL','spd_rpmFR','spd_rpmRL','spd_rpmRR')].min(axis=1)*np.pi/30*r/gear_ratio*3.6
                                            
# Output 62.2 ms ± 3.78 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</code></pre><p>That was very quick. As you can see, if you get used to indexing MATLAB tables, the switch to Pandas dataframes is a lot easier. The syntax (or rather, the logic) is very similar - though it is not exactly the same.</p><p>Now, we can just compare the speeds. First, I computed the start and end times for both drivers. This is not precise, I just defined a speed threshold of 20 km/h and found the instants when the car was slower and faster than that. Again, dataframe slicing is very helpful for this:</p><pre><code class="language-python"># Find index of first instant at which speed is greater than 20 km/h
index_start1 = df1[df1['Vehicle Speed']&gt;20].index[0]
index_start2 = df2[df2['Vehicle Speed']&gt;20].index[0]
time_start1 = df1['Time_s'][index_start1]
time_start2 = df2['Time_s'][index_start2]

# Find index of last instant at which speed is greater than 20 km/h
index_end1 = df1[df1['Vehicle Speed']&gt;20].index[-1]
index_end2 = df2[df2['Vehicle Speed']&gt;20].index[-1]
time_end1 = df1['Time_s'][index_end1]
time_end2 = df2['Time_s'][index_end2]

# Compute elapsed times
t_elap_1 = time_end1 - time_start1
t_elap_2 = time_end2 - time_start2
</code></pre><p>Next, I made a comparative plot (subplots again).  This time with a different approach, though:</p><p></p><pre><code class="language-python"># %% Compare the speeds of the two drivers
from plotly.subplots import make_subplots
import plotly.graph_objects as go


# Create figure with subplots and add titles
fig = make_subplots(
    rows=2,
    cols=1,
    shared_xaxes=True,
    shared_yaxes=False,
    subplot_titles=((f"Driver 1 approximate time : {t_elap_1:.1f} seconds&lt;br&gt;" 
                     f"Max. speed: {df1['Vehicle Speed'].max():.1f} km/h, "
                     f"mean speed: {df1['Vehicle Speed'].mean():.1f} km/h"), 
                    (f"Driver 2 approximate time : {t_elap_2:.1f} seconds&lt;br&gt;"
                    f"Max. Speed: {df2['Vehicle Speed'].max():.1f} km/h, "
                    f"mean speed: {df2['Vehicle Speed'].mean():.1f} km/h")
))

# Plot data for the first driver
fig.add_trace(
    go.Line(y=df1['Vehicle Speed'] ,x=df1.Time_s,name = 'Driver 1'),
    row = 1, col = 1)
# Add vertical lines to mark start and end points
for time in [time_start1, time_end1]:
    fig.add_shape(go.layout.Shape(type = "line",
                                    yref = "y", xref = "x",
                                    x0 = time, y0=0,
                                    x1 = time, y1 = 100),
                                    row=1, col=1)
fig.update_yaxes(title_text="Speed [km/h]", range=[0, 100], row=1, col=1)

# Plot data for the second driver    
fig.add_trace(
    go.Line(y=df2['Vehicle Speed'] ,x=df1.Time_s,name = 'Driver 2'),
    row = 2, col = 1)
# Add vertical lines to mark start and end points
for time in [time_start2, time_end2]:
    fig.add_shape(go.layout.Shape(type = "line",
                                    yref = "y", xref = "x",
                                    x0 = time, y0=0,
                                    x1 = time, y1 = 100),
                                    row=2, col=1)
fig.update_yaxes(title_text="Speed [km/h]", range=[0, 100], row=2, col=1)

fig.update_layout(title = {
                            'text': '&lt;b&gt;Driver time comparison&lt;/b&gt;', 
                            'xanchor' : 'center',
                            'x' : 0.5, 'y': .95, 'font_size' : 20
                            },
                showlegend=False)

fig
</code></pre><p>Notice that I used Plotly instead of Pyplot. Confusing names, right? Pyplot is the “vanilla” one that comes with Matplotlib. It is easier to learn when starting with Python from a Matlab background and is used a lot for scientific and engineering publication-grade figures. But Plotly offers the possibility to make interactive plots with a little coding, which is awesome. Just look at the results:</p><!--kg-card-begin: html--><iframe width="900" height="450" frameborder="0" scrolling="no" src="https://github.com/luisdamed/luisdamed.github.io/blob/master/replacing-matlab-with-python-part-2/Driver_time_Plotly.html" ></iframe><!--kg-card-end: html--><hr><h3 id="wrapping-up">Wrapping up</h3><p>We completed the first part of the task, obtaining the same results as the Matlab example - fortunately! otherwise, there would be a great error somewhere.</p><p>When writing this, I think I spent 80% of my time figuring out how to make the plots look like I wanted. The rest was not really that hard. This is not surprising, since Python has gained popularity precisely for being easy to learn. It is easy, as long as you use it as it is intended to. The best way to achieve this is to follow a set of guidelines for coding style, which are known as the <a href="https://docs.python-guide.org/writing/style/" rel="noopener noreferrer">“Pythonic”</a> way. I will try to learn this and apply it to my code as I go. I think it makes you think more in terms of code efficiency and make better use of the language.</p><p>I hope these code examples were useful for you. In the next post, I will complete the second part of the task, using histograms and statistics to analyze the vehicle speeds and the braking performance of the two drivers. </p><p>In the meantime, I hope you have a wonderful day!</p>
                </div>
                <div class="container medium">
                        <div class="share u-hover-wrapper">
    <a class="share-item share-facebook u-hover-item"
        href="https://www.facebook.com/sharer.php?u=http://localhost:2368/replacing-matlab-with-python-part-2/" target="_blank" rel="noopener"><i
            class="icon icon-facebook"></i></a>
    <a class="share-item share-twitter u-hover-item"
        href="https://twitter.com/intent/tweet?url=http://localhost:2368/replacing-matlab-with-python-part-2/&text=Replacing%20MATLAB%20with%20Python%20-%20Part%202%3A%20Formatting%20subplots%20and%20indexing%20data" target="_blank" rel="noopener"><i
            class="icon icon-twitter"></i></a>
    <a class="share-item share-pinterest u-hover-item"
        href="https://pinterest.com/pin/create/button/?url=http://localhost:2368/replacing-matlab-with-python-part-2/&media=&description=Replacing%20MATLAB%20with%20Python%20-%20Part%202%3A%20Formatting%20subplots%20and%20indexing%20data"
        target="_blank" rel="noopener" data-pin-do="none"><i class="icon icon-pinterest"></i></a>
    <a class="share-item share-linkedin u-hover-item"
        href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:2368/replacing-matlab-with-python-part-2/&title=Replacing%20MATLAB%20with%20Python%20-%20Part%202%3A%20Formatting%20subplots%20and%20indexing%20data"
        target="_blank" rel="noopener"><i class="icon icon-linkedin"></i></a>
    <a class="share-item share-reddit u-hover-item"
        href="https://reddit.com/submit?url=http://localhost:2368/replacing-matlab-with-python-part-2/&title=Replacing%20MATLAB%20with%20Python%20-%20Part%202%3A%20Formatting%20subplots%20and%20indexing%20data" target="_blank" rel="noopener"><i
            class="icon icon-reddit"></i></a>
    <a class="share-item share-tumblr u-hover-item"
        href="https://www.tumblr.com/widgets/share/tool?canonicalUrl=http://localhost:2368/replacing-matlab-with-python-part-2/&title=Replacing%20MATLAB%20with%20Python%20-%20Part%202%3A%20Formatting%20subplots%20and%20indexing%20data"
        target="_blank" rel="noopener"><i class="icon icon-tumblr"></i></a>
    <a class="share-item share-vk u-hover-item"
        href="http://vk.com/share.php?url=http://localhost:2368/replacing-matlab-with-python-part-2/&title=Replacing%20MATLAB%20with%20Python%20-%20Part%202%3A%20Formatting%20subplots%20and%20indexing%20data" target="_blank" rel="noopener"><i
            class="icon icon-vk"></i></a>
    <a class="share-item share-pocket u-hover-item" href="https://getpocket.com/edit?url=http://localhost:2368/replacing-matlab-with-python-part-2/"
        target="_blank" rel="noopener"><i class="icon icon-pocket"></i></a>
    <a class="share-item share-telegram u-hover-item"
        href="https://t.me/share/url?url=http://localhost:2368/replacing-matlab-with-python-part-2/&text=Replacing%20MATLAB%20with%20Python%20-%20Part%202%3A%20Formatting%20subplots%20and%20indexing%20data" target="_blank" rel="noopener"><i
            class="icon icon-telegram"></i></a>
</div>                            <section class="author">
        <div class="author-image-placeholder u-placeholder">
            <img class="author-image lazyload u-object-fit"
                data-srcset="/content/images/size/w150/2022/07/IMG_20210703_160904-1.jpg"
                src="../content/images/size/w150/2022/07/IMG_20210703_160904-1.jpg"
                srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
                alt="Luis Medina">
        </div>
        <div class="author-wrapper">
            <header class="author-header">
                <div class="author-header-wrapper">
                    <h4 class="author-name">Luis Medina</h4>
                    <div class="author-social">
                        <a class="author-social-item author-more"
                            href="../author/luis/index.html">More posts</a>
                    </div>
                </div>
            </header>
            <div class="author-bio"></div>
        </div>
    </section>
                </div>
            </article>
            <div class="navigation container medium">
        <div class="navigation-item navigation-previous">
            <a class="navigation-item-link button-arrow button-arrow-left" href="../using-matlab-and-statistics-to-analyze-raw-vehicle-data/index.html">
                <i class="button-arrow-icon icon icon-arrow-left"></i> Previous Post
            </a>
        </div>

</div>                        <section class="related-posts container medium">
            <h3 class="related-title"><span class="text">You might also like...</span></h3>
            <div class="row">
                    <div class="col-md-4 related-column">
                        <article class="post tag-matlab tag-engineering tag-data tag-replacingmatlabwithpython tag-signalprocessing">
                                <figure class="post-media">
        <div class="u-placeholder rectangle">
            <a class="post-image-link" href="../using-matlab-and-statistics-to-analyze-raw-vehicle-data/index.html">
                <img class="post-image lazyload u-object-fit"

                    data-srcset="https://images.unsplash.com/photo-1512717919743-801d3d85ec83?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDEwOHx8Y2FyJTIwdG95fGVufDB8fHx8MTY2MjMwMTQxMw&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 400w, https://images.unsplash.com/photo-1512717919743-801d3d85ec83?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDEwOHx8Y2FyJTIwdG95fGVufDB8fHx8MTY2MjMwMTQxMw&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 750w, https://images.unsplash.com/photo-1512717919743-801d3d85ec83?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDEwOHx8Y2FyJTIwdG95fGVufDB8fHx8MTY2MjMwMTQxMw&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 960w, https://images.unsplash.com/photo-1512717919743-801d3d85ec83?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDEwOHx8Y2FyJTIwdG95fGVufDB8fHx8MTY2MjMwMTQxMw&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 1140w, https://images.unsplash.com/photo-1512717919743-801d3d85ec83?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDEwOHx8Y2FyJTIwdG95fGVufDB8fHx8MTY2MjMwMTQxMw&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000 1920w"
                    data-sizes="auto" src="https://images.unsplash.com/photo-1512717919743-801d3d85ec83?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDEwOHx8Y2FyJTIwdG95fGVufDB8fHx8MTY2MjMwMTQxMw&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000"
                    srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
                     alt="Using MATLAB and statistics to analyze raw vehicle data">
            </a>
        </div>

    </figure>
                            <header class="post-header">
        <h2 class="post-title">
            <a class="post-title-link" href="../using-matlab-and-statistics-to-analyze-raw-vehicle-data/index.html">Using MATLAB and statistics to analyze raw vehicle data</a>
        </h2>
            <div class="post-meta">
                <span class="post-meta-item post-meta-date">
                    <time datetime="2022-09-04">Sep 4, 2022</time>
                </span>
                <span class="post-meta-item post-meta-length">
                    13 min read
                </span>
                    <span class="post-meta-item post-meta-tags">
                        <a class="post-tag post-tag-matlab" href="../tag/matlab/index.html"
                                title="MATLAB">MATLAB</a><a class="post-tag post-tag-engineering" href="../tag/engineering/index.html"
                                title="Engineering">Engineering</a><a class="post-tag post-tag-data" href="../tag/data/index.html"
                                title="Data">Data</a><a class="post-tag post-tag-replacingmatlabwithpython" href="../tag/replacingmatlabwithpython/index.html"
                                title="ReplacingMATLABwithPython">ReplacingMATLABwithPython</a><a class="post-tag post-tag-signalprocessing" href="../tag/signalprocessing/index.html"
                                title="SignalProcessing">SignalProcessing</a>
                    </span>
            </div>
</header>                        </article>
                    </div>
            </div>
        </section>
                </main>
</div>
        </div>
        <footer class="site-footer container large">
    <div class="copyright">
        Powered by <a href="https://ghost.org/" target="_blank" rel="noopener">Ghost</a>
    </div>

        <nav class="footer-nav">
            <ul class="nav-list u-plain-list">
        <li class="menu-item menu-item-sign-up"><a class="menu-item-link"
                href="index.html#/portal/">Sign up</a></li>
</ul>
        </nav>

    <div class="footer-social">
            <a class="footer-social-item footer-social-item-facebook" href="https://www.facebook.com/ghost"
                target="_blank" rel="noopener" aria-label="Facebook">
                <i class="icon icon-facebook"></i>
            </a>
            <a class="footer-social-item footer-social-item-twitter" href="https://twitter.com/ghost"
                target="_blank" rel="noopener" aria-label="Twitter">
                <i class="icon icon-twitter"></i>
            </a>
        <a class="footer-social-item footer-social-item-rss"
            href="https://feedly.com/i/subscription/feed/http://localhost:2368/rss/" target="_blank" rel="noopener"
            aria-label="RSS">
            <i class="icon icon-rss"></i>
        </a>
    </div>
</footer>    </div>

    <div class="dimmer"></div>

    <div class="off-canvas">
        <div class="canvas-close">
            <i class="canvas-icon icon icon-window-close"></i>
        </div>
        <div class="mobile-menu"></div>
    </div>

    <script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous">
    </script>
    <script src="../assets/built/main.min.js@v=6613460358"></script>

    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-core.min.js" integrity="sha512-9khQRAUBYEJDCDVP2yw3LRUQvjJ0Pjx0EShmaQjcHa6AXiOv6qHQu9lCAIR8O+/D8FtaCoJ2c0Tf9Xo7hYH01Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-fTl/qcO1VgvKtOMApX2PdZzkziyr2stM65GYPLGuYMnuMm1z2JLJG6XVU7C/mR+E7xBUqCivykuhlzfqxXBXbg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>

</html>