<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[Making stuff after office hours]]></title><description><![CDATA[Making stuff after office hours]]></description><link>http://localhost:2368/</link><image><url>http://localhost:2368/favicon.png</url><title>Making stuff after office hours</title><link>http://localhost:2368/</link></image><generator>Ghost 5.2</generator><lastBuildDate>Fri, 09 Sep 2022 19:08:48 GMT</lastBuildDate><atom:link href="http://localhost:2368/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Using MATLAB and statistics to analyze raw vehicle data]]></title><description><![CDATA[I am sharing an example of the workflow I would follow for getting insights from real-world data using histograms and some very basic statistics.]]></description><link>http://localhost:2368/using-matlab-and-statistics-to-analyze-raw-vehicle-data/</link><guid isPermaLink="false">6307015cdab1415e3c83e90f</guid><category><![CDATA[MATLAB]]></category><category><![CDATA[Engineering]]></category><category><![CDATA[Data]]></category><category><![CDATA[ReplacingMATLABwithPython]]></category><category><![CDATA[SignalProcessing]]></category><dc:creator><![CDATA[Luis Medina]]></dc:creator><pubDate>Sat, 20 Aug 2022 15:23:00 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1512717919743-801d3d85ec83?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=MnwxMTc3M3wwfDF8c2VhcmNofDEwOHx8Y2FyJTIwdG95fGVufDB8fHx8MTY2MjMwMTQxMw&amp;ixlib=rb-1.2.1&amp;q=80&amp;w=2000" medium="image"/><content:encoded><![CDATA[<img src="https://images.unsplash.com/photo-1512717919743-801d3d85ec83?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=MnwxMTc3M3wwfDF8c2VhcmNofDEwOHx8Y2FyJTIwdG95fGVufDB8fHx8MTY2MjMwMTQxMw&amp;ixlib=rb-1.2.1&amp;q=80&amp;w=2000" alt="Using MATLAB and statistics to analyze raw vehicle data"><p>It&#x2019;s been a couple of weeks since I published the <a href="https://makerluis.com/replacing-matlab-with-python-part-1/index.html">initial post</a> of a series about replacing MATLAB with Python. If you haven&#x2019;t read it yet, the short story is that I forced myself to use Python to do some of the tasks I would normally do using MATLAB at work. I committed to sharing what I&apos;ve learned in the process, including simple code examples to illustrate it, which may be useful if you are interested in doing something similar. I&apos;m no expert, though, so don&apos;t expect to see super complex codes or analyses here!</p><p>However, I figured that it would be easier to share separately the MATLAB examples and the Python ones. Mainly because, otherwise, the articles would be excessively long.</p><p>In this second entry, I am sharing an example of the workflow I would follow for getting insights from real-world data using histograms and some very basic statistics.</p><p>We will be using two datasets containing raw data logged from the CAN bus of a <a href="https://www.imeche.org/events/formula-student">Formula Student Electric</a> car. The data is already stored in a .CSV format to make this more &#x201C;universal&#x201D;, since there are different formats for storing automotive data.</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://drive.google.com/drive/folders/16f2fLXelTBtj9vFxSSiNUQrmIUy3IEPX?usp=sharing"><div class="kg-bookmark-content"><div class="kg-bookmark-title">RaceCar data - Google Drive</div><div class="kg-bookmark-description"></div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://ssl.gstatic.com/docs/doclist/images/drive_2022q3_32dp.png" alt="Using MATLAB and statistics to analyze raw vehicle data"><span class="kg-bookmark-author">Google Drive</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://drive-thirdparty.googleusercontent.com/128/type/text/csv" alt="Using MATLAB and statistics to analyze raw vehicle data"></div></a></figure><p>For context, the datasets were recorded while two drivers tested exactly the same vehicle in exactly the same circuit. On the same day, a few minutes apart from each other. There was no transponder installed for recording the lap time accurately, and the information from the electric motors is not available for some reason. This is about all the context we need. We want to analyze the data from both drivers but won&#x2019;t go into the details. </p><hr><h3 id="let%E2%80%99s-jump-right-into-it">Let&#x2019;s jump right into it!</h3><p>When using MATLAB, I load the data from the CSV files, store the data in some variables, and define the constants that I am going to use later.</p><pre><code class="language-matlab">%% Get descriptive statistics from CAN datalogs
close all, clc

filename1 = &apos;driver1.csv&apos;;
filename2 = &apos;driver2.csv&apos;;

% Read file 1
t1 = readtable(filename1);
% Verify that I get all the columns I need
t1.Properties.VariableNames

% Repeat for file 2
t2 = readtable(filename2);
t2.Properties.VariableNames

%% Define vehicle parameters
% This was a Formula Student Electric car, with four in-wheel electric
% motors coupled to an epicyclic transmission, all four with the same gear ratio
gear_ratio = 16;    % Transmission gear ratio
r = 0.263;          % Wheel radius [m]</code></pre><p>I&apos;m using tables to handle the data because I find them very easy to use. Additionally, using tables in MATLAB can help you transition more easily to using Pandas data frames if you want to. This will be more evident later on. Tables are not the most efficient way to handle very large datasets, but they do offer some convenience and if you know how to index them, they work great.</p><p>Let&#x2019;s move on. I have the data loaded on MATLAB, so now I can do stuff. As I&#x2019;ve <a href="https://makerluis.com/replacing-matlab-with-python-part-1/index.html#example-1-simple-time-series-visualization">mentioned before</a>, a good practice is to start with a simple plot or, in this case, a bunch of them, &#xA0;since we have few variables and files.</p><pre><code class="language-matlab">%% Plot the data available, just to have a quick overview
figure(&apos;Position&apos;, [10 10 1200 400])
tiledlayout(&apos;flow&apos;, &apos;TileSpacing&apos;, &apos;compact&apos;)

for i_plot = 2:size(t1,2)
    
    nexttile
    plot(t1.Time_s, t1{:, i_plot}, &apos;DisplayName&apos;, &apos;1&apos;)
    hold on
    plot(t2.Time_s, t2{:, i_plot}, &apos;DisplayName&apos;, &apos;2&apos;)
    title(t1.Properties.VariableNames{i_plot}, &apos;Interpreter&apos; , &apos;none&apos;)
    legend
    
end
</code></pre><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://localhost:2368/content/images/2022/09/DATA_plot_MATLAB-1.jpg" class="kg-image" alt="Using MATLAB and statistics to analyze raw vehicle data" loading="lazy" width="2000" height="667" srcset="http://localhost:2368/content/images/size/w600/2022/09/DATA_plot_MATLAB-1.jpg 600w, http://localhost:2368/content/images/size/w1000/2022/09/DATA_plot_MATLAB-1.jpg 1000w, http://localhost:2368/content/images/size/w1600/2022/09/DATA_plot_MATLAB-1.jpg 1600w, http://localhost:2368/content/images/size/w2400/2022/09/DATA_plot_MATLAB-1.jpg 2400w" sizes="(min-width: 720px) 720px"><figcaption>Time series plots of the data stored in the files. This is useful to visualize what kind of information we have.</figcaption></figure><p>Great! we have comparable data in both files. We have pressure data from a sensor in the hydraulic circuit of the car, raw acceleration data from an <a href="https://en.wikipedia.org/wiki/Inertial_measurement_unit">IMU</a>, and the rotational speed of the four motors attached to the wheels. There is a slight time offset between the two data sets, and one of them is a bit longer. This is raw data, so it is something completely normal. </p><p>Let&#x2019;s find out which driver was faster. &#xA0;To do this, we need to compute the vehicle speed. </p><hr><h3 id="estimating-the-vehicle-speeds">Estimating the vehicle speeds</h3><p></p><p>This is not easy at all - it might seem, <a href="http://dx.doi.org/10.26552/com.C.2021.2.B117-B129">but it is not</a> - at least if you want to do it accurately. What we can do is settle down for a simplified calculation assuming the following:</p><ul><li>When the vehicle is accelerating, the speed of the car is similar to the speed of the contact point of the slowest tire, i.e. the one that rotates slower than the others and thus has a smaller <a href="https://www.racecar-engineering.com/tech-explained/tyre-dynamics/#:~:text=The%20slip%20ratio%20is%20similar,tyre%20that%20has%20lost%20traction">slip ratio</a>.</li><li>On the other hand, when the car is braking, the slowest tire is most likely locked, with a higher absolute slip ratio than the others. So in this case the vehicle&apos;s speed is closer to that of the fastest spinning tire - no accelerating torque is present.</li></ul><p>This is a rough estimate but should be enough for this analysis. But before we do this, we need to do some work to clean up the raw acceleration data. I will remove the <a href="https://en.wikipedia.org/wiki/DC_bias">DC offset</a>, and filter the noise.</p><pre><code class="language-MATLAB">%% Filter the longitudinal acceleration

% Compute the sum of the wheel speeds
sum_of_speeds1 = t1.spd_rpmFR + t1.spd_rpmFL + t1.spd_rpmRR + t1.spd_rpmRL;
sum_of_speeds2 = t2.spd_rpmFR + t2.spd_rpmFL + t2.spd_rpmRR + t2.spd_rpmRL;

% Remove any DC - offset from the raw acceleration data
t1.AccXNoOffs = t1.AccX - median(table2array(t1(sum_of_speeds1 == 0, &apos;AccX&apos;)));
t2.AccXNoOffs = t2.AccX - median(table2array(t2(sum_of_speeds2 == 0, &apos;AccX&apos;)));

% Filter the signals
t1.AccX = sgolayfilt(t1.AccXNoOffs, 3, 101);
t2.AccX = sgolayfilt(t2.AccXNoOffs, 3, 101);

% COmpare the signals
figure(&apos;Position&apos;, [10 10 1200 400]);
hold on
plot(t1.Time_s, t1.AccXNoOffs, &apos;-k&apos;, &apos;DisplayName&apos;, &apos;Raw AccX (removed DC offset)&apos;, &apos;linewidth&apos;, .5)
plot(t1.Time_s, t1.AccX, &apos;-r&apos;, &apos;DisplayName&apos;, &apos;AccX (filtered)&apos;, &apos;linewidth&apos;, 1.5 )
xlim([600, 650])
xlabel(&apos;Time [seconds]&apos;)
ylabel(&quot;Acceleration [G - units]&quot;)
legend
grid minor
</code></pre><figure class="kg-card kg-image-card"><img src="http://localhost:2368/content/images/2022/09/raw_vs_filtered_Acc_MATLAB.jpg" class="kg-image" alt="Using MATLAB and statistics to analyze raw vehicle data" loading="lazy" width="2000" height="667" srcset="http://localhost:2368/content/images/size/w600/2022/09/raw_vs_filtered_Acc_MATLAB.jpg 600w, http://localhost:2368/content/images/size/w1000/2022/09/raw_vs_filtered_Acc_MATLAB.jpg 1000w, http://localhost:2368/content/images/size/w1600/2022/09/raw_vs_filtered_Acc_MATLAB.jpg 1600w, http://localhost:2368/content/images/size/w2400/2022/09/raw_vs_filtered_Acc_MATLAB.jpg 2400w" sizes="(min-width: 720px) 720px"></figure><!--kg-card-begin: markdown--><p>I filtered the acceleration signals using a Finite-Impulse-Response filter, in this case, a Savitzky&#x2013;Golay filter. This type of filter does a good job preserving the height and location of the peaks and the area below them. Implementing this type of filter in MATLAB is as simple as just typing the <a href="https://it.mathworks.com/help/signal/ref/sgolayfilt.html">sgolay</a> command and including some parameters <a href="https://nirpyresearch.com/choosing-optimal-parameters-savitzky-golay-smoothing-filter/">chosen accordingly</a>. <em>But only if you have the Signal Processing Toolbox license</em>. So this might be one of the reasons to consider using free software options. Of course, with a little more work, you can implement a similar filter yourself using &#x201C;standard&#x201D; MATLAB commands. (edit: if you actually check the book <a href="https://www.ece.rutgers.edu/~orfanidi/intro2sp/"><em>Introduction to Signal Processing</em></a> cited in the MATLAB documentation of the filter, you can actually see the implementation for many types of digital filters both in MATLAB and C, and download the files. Cool!)</p>
<!--kg-card-end: markdown--><p>Now, how to determine the vehicle speed using the approach I mentioned before?</p><p>Easy, right? Just make a <code>for</code> loop and iterate through the rows of the table. When the acceleration is positive take the minimum wheel speed, when it is negative, take the maximum one. And of course, convert each value to linear speed.</p><pre><code class="language-matlab">%% Estimate the vehicle speed: the for-loop way
% Extract the wheel rotational speed data from the two files
wRPM1 = t1(:,{&apos;spd_rpmFL&apos;, &apos;spd_rpmFR&apos;, &apos;spd_rpmRL&apos;, &apos;spd_rpmRR&apos;}); 
wRPM2 = t2(:,{&apos;spd_rpmFL&apos;, &apos;spd_rpmFR&apos;, &apos;spd_rpmRL&apos;, &apos;spd_rpmRR&apos;});

tic
for i_ax1=1:height(wRPM1)
    
   if t1.AccX(i_ax1,1)&gt;0
       VEL1_for(i_ax1,1)=min(wRPM1{i_ax1,:})*(pi/30)*r/gear_ratio*3.6;
   else
       VEL1_for(i_ax1,1)=max(wRPM1{i_ax1,:})*(pi/30)*r/gear_ratio*3.6;
   end
end
toc % Elapsed time is 289.592689 seconds. &lt;--- NOT GOOD!
</code></pre><p>That took forever! I don&apos;t want to wait that much time when doing this kind of thing! What if the data grows larger, or if I need to compare 100 files instead of 2, should I wait 4 hours? Maybe my PC is not the fastest, but there has to be a better way! </p><p>Fortunately, yes, there is a better way. We can use indexing methods instead of for loops.</p><pre><code class="language-matlab">%% Estimate the vehicle speed: Release the power of table indexing
tic

% Create empty columns for storing the vehicle speed
t1.Veh_Spd = zeros(height(t1), 1);
t2.Veh_Spd = zeros(height(t2), 1);

t1(t1.AccX &gt; 0, &apos;Veh_Spd&apos;) = table(min(t1{t1.AccX &gt; 0,...
    {&apos;spd_rpmFL&apos;,&apos;spd_rpmFR&apos;,&apos;spd_rpmRL&apos;,&apos;spd_rpmRR&apos;}}, [], 2)*pi/30*r/gear_ratio*3.6);
t1(t1.AccX &lt;= 0, &apos;Veh_Spd&apos;) = table(max(t1{t1.AccX &lt;= 0,...
    {&apos;spd_rpmFL&apos;,&apos;spd_rpmFR&apos;,&apos;spd_rpmRL&apos;,&apos;spd_rpmRR&apos;}}, [], 2)*pi/30*r/gear_ratio*3.6);     

t2(t2.AccX &gt; 0, &apos;Veh_Spd&apos;) = table(min(t2{t2.AccX &gt; 0,...
    {&apos;spd_rpmFL&apos;,&apos;spd_rpmFR&apos;,&apos;spd_rpmRL&apos;,&apos;spd_rpmRR&apos;}}, [], 2)*pi/30*r/gear_ratio*3.6);
t2(t2.AccX &lt;= 0, &apos;Veh_Spd&apos;) = table(max(t2{t2.AccX &lt;= 0,...
    {&apos;spd_rpmFL&apos;,&apos;spd_rpmFR&apos;,&apos;spd_rpmRL&apos;,&apos;spd_rpmRR&apos;}}, [], 2)*pi/30*r/gear_ratio*3.6);
    
toc % Elapsed time is 0.018584 seconds.
</code></pre><p>Awesome! we get both velocity vectors in just a fraction of a second, instead of only one in 5 minutes. I just took advantage of the indexing capabilities of MATLAB - it was designed to work with matrix operations, so why not use them? &#xA0;Let me explain a bit:</p><p>I first added empty columns to the tables. Then, I indexed the tables, selecting only the rows for which the acceleration was positive, and the empty column I just created.</p><p>In that selection, I inserted the minimum of the motor speeds for each row, again, considering only the rows for which the acceleration was positive, and converting that to linear speeds. </p><p>Then I did the same for the opposite case when the acceleration was negative.</p><p>A similar approach can be used to avoid <code>for</code> loops when using numeric arrays or cell arrays instead of tables. The difference is just the syntax for indexing them.</p><p>Moving on...</p><hr><h3 id="comparing-the-speeds-of-both-drivers">Comparing the speeds of both drivers</h3><p></p><p>Let&#x2019;s see what we&#x2019;ve got as vehicle speeds:</p><p></p><pre><code class="language-matlab">%% Create a figure with a tiled layout
                                                
time_series = figure(&apos;Position&apos;, [10 10 1200 400]);
tiles = tiledlayout(2,1);
title(tiles, &apos;Driver time comparison&apos;)
xlabel(tiles, &apos;Time [s]&apos;)

%% Plot the data from the first file

nexttile
plot(t1.Time_s, t1.Veh_Spd, &apos;-b&apos;)
ylabel(&apos;Vehicle speed [km/h]&apos;)
hold on
time_start1 = t1.Time_s(min(find( t1.Veh_Spd &gt; 20)));
time_end1 = t1.Time_s(max(find(t1.Veh_Spd &gt; 20)));
t_elap_1 = time_end1 - time_start1;

plot([[time_start1 time_end1]; [time_start1 time_end1] ], ...
    repmat(ylim&apos;,1, 2), &apos;Color&apos;, &apos;k&apos;, &apos;LineWidth&apos;, 2);
title([&apos;Driver 1 approximate time: &apos; num2str(time_end1 - time_start1, &apos;%0.1f&apos;) &apos; seconds&apos;])
grid minor
xlim([0, 1200])

%% Plot the data from the second file

nexttile
plot(t2.Time_s, t2.Veh_Spd, &apos;-b&apos;)
ylabel(&apos;Vehicle speed [km/h]&apos;)
hold on
time_start2 = t2.Time_s(min(find(t2.Veh_Spd &gt; 20)));
time_end2 = t2.Time_s(max(find(t2.Veh_Spd &gt; 20)));
t_elap_1 = time_end1 - time_start1;

plot([[time_start2 time_end2]; [time_start2 time_end2] ], repmat(ylim&apos;,1, 2), &apos;Color&apos;, &apos;k&apos;, &apos;LineWidth&apos;, 2);
title([&apos;Driver 2 approximate time: &apos; num2str(time_end2 - time_start2, &apos;%0.1f&apos;) &apos; seconds&apos;])
grid minor
xlim([0, 1200])

</code></pre><figure class="kg-card kg-image-card"><img src="http://localhost:2368/content/images/2022/09/Drivers_time_plot_MATLAB-2.jpg" class="kg-image" alt="Using MATLAB and statistics to analyze raw vehicle data" loading="lazy" width="2000" height="667" srcset="http://localhost:2368/content/images/size/w600/2022/09/Drivers_time_plot_MATLAB-2.jpg 600w, http://localhost:2368/content/images/size/w1000/2022/09/Drivers_time_plot_MATLAB-2.jpg 1000w, http://localhost:2368/content/images/size/w1600/2022/09/Drivers_time_plot_MATLAB-2.jpg 1600w, http://localhost:2368/content/images/size/w2400/2022/09/Drivers_time_plot_MATLAB-2.jpg 2400w" sizes="(min-width: 720px) 720px"></figure><p>Ok, the second driver was<em> </em><strong><em>a lot</em> </strong>faster, and he probably also did a few more laps during the test session. There could be very noticeable differences in the driving styles since they were using the same car. So let&#x2019;s see If we can spot them. First, let&#x2019;s look at their speeds from a statistical perspective:</p><p></p><pre><code class="language-matlab">%% Get statistics about the driving speeds                                               
histograms = figure(&apos;Name&apos;, [&apos;Histograms comparison&apos;], &apos;Position&apos;, [10 10 1200 400]);
tiles = tiledlayout(2,1);
title(tiles, &apos;Comparing vehicle speed data using histograms&apos;)
xlabel(tiles, &apos;Vehicle speed [km/h]&apos;)
binEdges = 0:5:100;

nexttile
VEL1 = t1.Veh_Spd;
VEL2 = t2.Veh_Spd;
n_vel=max(numel(VEL1),numel(VEL2));

VEL1(end+1:n_vel)=nan;
VEL2(end+1:n_vel)=nan;
% &quot;Old&quot; method for creating a histogram
hist([VEL1, VEL2], binEdges);
ylabel(&apos;Counts&apos;)

legend(&apos;Driver 1&apos;, &apos;Driver 2&apos;)
title(&apos;Bar plots of histogram data (hist command)&apos;)
grid on

nexttile
% Newer way of creating a histogram
h1 = histogram(t1.Veh_Spd, binEdges, &apos;normalization&apos; , &apos;probability&apos;)
hold on
h2 = histogram(t2.Veh_Spd, binEdges, &apos;normalization&apos; , &apos;probability&apos;)
legend(&apos;Driver 1&apos;, &apos;Driver 2&apos;)
title(&apos;Plotting two overlapping histograms (histogram command)&apos;)
ylabel(&apos;Probability&apos;)
grid on

%% Get some descriptive parameters
v1_mean = mean(t1.Veh_Spd, &apos;omitnan&apos;)       % Means of the two samples
v2_mean = mean(t2.Veh_Spd, &apos;omitnan&apos;)
v1_median = median(t1.Veh_Spd, &apos;omitnan&apos;)	% Medians of the two samples
v2_median = median(t2.Veh_Spd, &apos;omitnan&apos;)
v1_std = std(t1.Veh_Spd, &apos;omitnan&apos;)         % Standard deviations of the two samples
v2_std = std(t2.Veh_Spd, &apos;omitnan&apos;)
</code></pre><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://localhost:2368/content/images/2022/09/histogram_Speed_MATLAB.jpg" class="kg-image" alt="Using MATLAB and statistics to analyze raw vehicle data" loading="lazy" width="2000" height="667" srcset="http://localhost:2368/content/images/size/w600/2022/09/histogram_Speed_MATLAB.jpg 600w, http://localhost:2368/content/images/size/w1000/2022/09/histogram_Speed_MATLAB.jpg 1000w, http://localhost:2368/content/images/size/w1600/2022/09/histogram_Speed_MATLAB.jpg 1600w, http://localhost:2368/content/images/size/w2400/2022/09/histogram_Speed_MATLAB.jpg 2400w" sizes="(min-width: 720px) 720px"><figcaption>Two different ways of plotting histograms in MATLAB. There is also the &quot;bar&quot; command. I didn&#x2019;t bother to normalize the data on the left side, in this particular case it doesn&#x2019;t matters much.</figcaption></figure><p>The histograms on the right side are normalized so that we can compare both files, even if the time of the second driver was shorter - which means that we have fewer data points. By dividing the counts of each bin by the size of the total sample, we actually get a representation of the discrete probability distribution. In this case, the width of the bins is constant, but if there were bins of different sizes, we would also need to divide by the width of the bins to get a valid comparison.</p><hr><h3 id="analyzing-the-braking-pressures">Analyzing the braking pressures</h3><p></p><p>The histograms show that the second driver spent more time at speeds above 60 km/h than the first one. &#xA0;But both drivers were using exactly the same car. And the mean and median speed values are not that different between the two. So what could have changed? Perhaps it is also important to see how they were using the brakes.</p><pre><code class="language-matlab">%% Create histograms of the braking pressures
% This considers only the use of mechanical brakes.
% The electric car can also use the electric motors for regenerative braking. 
% This is enabled through a small portion of the brake pedal travel.
% These two particular datalogs do not contain information about that, so we will
% focus on the mechanical (hydraulic) brakes.

t1.BrakeFront(t1.BrakeFront &lt;=0) = 0; %filter negative pressure values
t2.BrakeFront(t2.BrakeFront &lt;=0) = 0; %filter negative pressure values
%%
figure;
hold on
histogram(t1.BrakeFront, &apos;Normalization&apos;, &apos;probability&apos;)
histogram(t2.BrakeFront, &apos;Normalization&apos;, &apos;probability&apos;)
ylabel(&apos;Probability&apos;)
xlabel(&apos;Pressure [bar]&apos; )
title(&apos;Brakes pressure in the front circuit &apos;)
legend(&apos;Driver 1&apos;, &apos;Dirver 2&apos;)
grid on
</code></pre><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://localhost:2368/content/images/2022/09/pressure_hist_2Driver_ARROWS_tile1_MATLAB.jpg" class="kg-image" alt="Using MATLAB and statistics to analyze raw vehicle data" loading="lazy" width="2000" height="577" srcset="http://localhost:2368/content/images/size/w600/2022/09/pressure_hist_2Driver_ARROWS_tile1_MATLAB.jpg 600w, http://localhost:2368/content/images/size/w1000/2022/09/pressure_hist_2Driver_ARROWS_tile1_MATLAB.jpg 1000w, http://localhost:2368/content/images/size/w1600/2022/09/pressure_hist_2Driver_ARROWS_tile1_MATLAB.jpg 1600w, http://localhost:2368/content/images/2022/09/pressure_hist_2Driver_ARROWS_tile1_MATLAB.jpg 2262w" sizes="(min-width: 720px) 720px"><figcaption>If we zoomed in, we would notice that the second driver also was using the brakes at higher pressures compared to the first one. But I left the zoomed-out scale to highlight the peak on the left side.</figcaption></figure><p></p><p>The high bar on the left side represents the low-pressure values, which are the most common values present during driving. This makes sense since one doesn&#x2019;t drive with the brakes pressed, especially during a race. But driver 1 did spend more time braking. We can see that the probability of having the brakes completely disengaged (e.g.about zero hydraulic pressure in the circuit) is lower for driver one. And we also see that the probability of having low pressures in the circuit is higher in case 1. This could mean that the first driver actually had the brakes slightly pressed constantly, perhaps without noticing. </p><p>Let&#x2019;s see also at what speeds the drivers were braking. </p><hr><h3 id="finding-the-vehicle-speeds-at-the-start-of-the-braking-maneuvers">Finding the vehicle speeds at the start of the braking maneuvers</h3><p></p><p>To do this, we need to identify the speeds at the start of the braking maneuvers. I defined a small pressure value to use as a threshold for identifying when the brakes are pressed. This is a bit of an iterative process - you don&#x2019;t get it right the first time and need to adjust the value until the results make sense.</p><!--kg-card-begin: markdown--><p>Let&apos;s use again the power of indexing, I don&apos;t want to wait forever with a for loop. We just need to determine in which rows there was a change in pressure that we could recognize as a pedal press. We also need to consider only the cases in which the vehicle was actually moving. So we have three conditions:</p>
<ol>
<li>Low pressure on instant t</li>
<li>High pressure (greater than a threshold) on instant t+1</li>
<li>Vehicle speed greater than a minimum value at instant t+1</li>
</ol>
<p>I indexed the tables using these three conditions and used parentheses to make them more readable (they are not really needed for the code to work). The trick is to impose the second and third conditions (t+1) by indexing the table from the second row. This creates the shift in time values that we would normally obtain using a loop with an increasing counter:</p>
<!--kg-card-end: markdown--><p></p><pre><code class="language-matlab">%% Find the index of the start of braking

%Define a pressure threshold value to consider as start of braking
p_start = 2; % bar

% Create indices for the start of the braking maneuvers
id_start1 = (t1.BrakeFront &lt;= p_start) &amp; ([t1.BrakeFront(2:end);0] &gt; p_start) &amp; ([t1.Veh_Spd(2:end); 0] &gt;= 15);
id_start2 = (t2.BrakeFront &lt;= p_start) &amp; ([t2.BrakeFront(2:end);0] &gt; p_start) &amp; ([t2.Veh_Spd(2:end); 0] &gt;= 15);

%% Verify that the identified points make sense
figure
plot(t1.Time_s, t1.BrakeFront, &apos;b&apos;, &apos;LineWidth&apos;, 1,&apos;DisplayName&apos;, &apos;Pressure&apos;)
hold on
x = [t1.Time_s(id_start1), t1.Time_s(id_start1)];

% Show a black vertical line at the start of each braking maneuver
line(x, ylim, &apos;Color&apos;, &apos;k&apos;, &apos;LineWidth&apos;, .5, &apos;HandleVisibility&apos;, &apos;off&apos;); 
yline(p_start, &apos;DisplayName&apos;, &apos;Brake start threshold&apos; ,&apos;LineWidth&apos;, 2) 
ylabel(&apos;Pressure [bar]&apos; )
yyaxis right

plot(t1.Time_s, t1.Veh_Spd, &apos;r&apos;, &apos;LineWidth&apos;, 1, &apos;DisplayName&apos;, &apos;Vehicle Spd&apos;)
set(gca, &apos;Ycolor&apos;, &apos;r&apos;)
ylabel(&apos;Vehicle speed [km/h]&apos;)
xlabel(&apos;Time [s]&apos; ), xlim([750, 800])
legend, grid on
</code></pre><figure class="kg-card kg-image-card"><img src="http://localhost:2368/content/images/2022/09/Start_of_brake_MATLAB-1.jpg" class="kg-image" alt="Using MATLAB and statistics to analyze raw vehicle data" loading="lazy" width="2000" height="667" srcset="http://localhost:2368/content/images/size/w600/2022/09/Start_of_brake_MATLAB-1.jpg 600w, http://localhost:2368/content/images/size/w1000/2022/09/Start_of_brake_MATLAB-1.jpg 1000w, http://localhost:2368/content/images/size/w1600/2022/09/Start_of_brake_MATLAB-1.jpg 1600w, http://localhost:2368/content/images/size/w2400/2022/09/Start_of_brake_MATLAB-1.jpg 2400w" sizes="(min-width: 720px) 720px"></figure><hr><p>Great! we have identified the starts of braking maneuvers. Now let&#x2019;s look at the speeds at which the drivers started braking. We just have to create histograms of the vehicle speeds using the indices we just found:</p><p></p><pre><code class="language-MATLAB">%% Create histograms and plot them
                                                
histograms = figure(&apos;Name&apos;, [&apos;Histograms comparison&apos;], &apos;Position&apos;, [10 10 900 600]);
title(&apos;MATLAB figure&apos;)
xlabel(&apos;Vehicle speed [km/h]&apos;)
binEdges = 10:5:100;

histogram(t1.Veh_Spd(id_start1), binEdges, &apos;Normalization&apos; , &apos;probability&apos;)
hold on
histogram(t2.Veh_Spd(id_start2), binEdges, &apos;Normalization&apos; , &apos;probability&apos;)
legend(&apos;Driver 1&apos;, &apos;Driver 2&apos;)
ylabel(&apos;Probability&apos;)
xlabel(&apos;Vehicle speed at the start of braking [km/h]&apos;)
grid on
</code></pre><figure class="kg-card kg-image-card"><img src="http://localhost:2368/content/images/2022/09/VEL_start_brakin_MATLAB-3.jpg" class="kg-image" alt="Using MATLAB and statistics to analyze raw vehicle data" loading="lazy" width="2000" height="667" srcset="http://localhost:2368/content/images/size/w600/2022/09/VEL_start_brakin_MATLAB-3.jpg 600w, http://localhost:2368/content/images/size/w1000/2022/09/VEL_start_brakin_MATLAB-3.jpg 1000w, http://localhost:2368/content/images/size/w1600/2022/09/VEL_start_brakin_MATLAB-3.jpg 1600w, http://localhost:2368/content/images/2022/09/VEL_start_brakin_MATLAB-3.jpg 2250w" sizes="(min-width: 720px) 720px"></figure><p>Looking at the histograms, we can see that the first driver initiated more braking maneuvers between 60 and 70 km/h, but he also initiated more braking maneuvers at lower speeds - below 55 km/h. The second driver was braking at higher speeds. </p><hr><p>This was a simple toy example of how to use MATLAB to do some tasks with real-world data. We used histograms to get valuable insights from the data, something that would not be easy if we just used time series plots to visualize the two datasets.</p><p>Sometimes we can be too concerned with the time-based evolution of the data we are looking at, rather than their distribution, or the trends and correlations between different variables.</p><p>Seeing how histograms can be easily used to get insights without actually needing to look at the times series can sometimes open a new perspective when looking at data recorded from physical things (cars, machines, sensors, etc).</p><p>Hopefully, this example was useful or interesting for you if you are just getting started doing similar things. I would be glad if it was in any way :) </p><p>In the next entry, I will repeat the analysis (at least the main part) using Python instead of MATLAB. Stay tuned!</p>]]></content:encoded></item><item><title><![CDATA[Replacing MATLAB with Python - Part 1]]></title><description><![CDATA[Stick with me in this series of posts if you want to see some examples of using Python for MATLAB users. I am not an expert, and the code I will share can probably be improved, but I think these practical examples can be useful for a beginner like me.]]></description><link>http://localhost:2368/replacing-matlab-with-python-part-1/</link><guid isPermaLink="false">62e81ab9566ade6d90ed3bc2</guid><category><![CDATA[Python]]></category><category><![CDATA[MATLAB]]></category><category><![CDATA[Engineering]]></category><dc:creator><![CDATA[Luis Medina]]></dc:creator><pubDate>Sat, 20 Aug 2022 08:32:32 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1497285597995-6ed7de6bfebd?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=MnwxMTc3M3wwfDF8c2VhcmNofDE3fHxvcGVufGVufDB8fHx8MTY2MDk4NTE3NQ&amp;ixlib=rb-1.2.1&amp;q=80&amp;w=2000" medium="image"/><content:encoded><![CDATA[<img src="https://images.unsplash.com/photo-1497285597995-6ed7de6bfebd?crop=entropy&amp;cs=tinysrgb&amp;fit=max&amp;fm=jpg&amp;ixid=MnwxMTc3M3wwfDF8c2VhcmNofDE3fHxvcGVufGVufDB8fHx8MTY2MDk4NTE3NQ&amp;ixlib=rb-1.2.1&amp;q=80&amp;w=2000" alt="Replacing MATLAB with Python - Part 1"><p>I work a full-time job as an automotive Control Systems Engineer, and - usually - a big chunk of my time during the day is employed using MATLAB/Simulink for different types of tasks.</p><p>I recently spent a couple of weeks without an individual MATLAB license at work due to different issues that I am not going to address. Of course, I had the chance to use workstations with shared licenses in the office to continue working in <a href="https://en.wikipedia.org/wiki/Model-based_design#:~:text=Model%2Dbased%20design%20(MBD),%2C%20aerospace%2C%20and%20automotive%20applications.">Model-Based software development</a>. For that kind of activity, you can&apos;t just go around the license problem, since you work on shared files and projects within a team, and you need to produce models (code) that are part of a larger project.</p><!--kg-card-begin: markdown--><p>However, I took the chance to sharpen my Python skills while completing some of the other tasks I had to do, mainly when analyzing data. I could have used other alternatives, like <a href="https://octave.org/">GNU Octave</a> - which even has the same MATLAB syntax, or <a href="https://www.scilab.org/">Scilab</a>. But I wanted to learn more about Python, since it is a <em>general-purpose programming language</em>.</p>
<p>I figured that I could share some of the things I learned, and started to write an article that suddenly was too long for a single post. So this will be an ongoing series of posts. In each entry, I will share a simple but practical example of how to do a certain task with MATLAB, but using Python instead. Probably some of the code can be improved, but I think it can be useful to see these examples if you are a beginner like me.</p>
<p>I think this is important since Python opens the possibilities for individuals and companies that cannot afford to buy an expensive MATLAB license, or that already using MATLAB but have use cases for which MATLAB can be easily replaced with Python, cutting down the license costs.</p>
<p>MATLAB is still being used widely, especially in the Automotive and Aerospace industries, but the usage of Python has grown dramatically in many different sectors, since it can be used for many other things - like I said, general-purpose. <em>Python cannot really be compared with MATLAB, as they were designed for different purposes</em>, but I will focus on the use cases that can overlap between the two of them.</p>
<!--kg-card-end: markdown--><!--kg-card-begin: html--><script type="text/javascript" src="https://ssl.gstatic.com/trends_nrtr/3045_RC01/embed_loader.js"></script> <script type="text/javascript"> trends.embed.renderExploreWidget("TIMESERIES", {"comparisonItem":[{"keyword":"/m/05z1_","geo":"","time":"2004-01-01 2022-08-12"},{"keyword":"/m/053_x","geo":"","time":"2004-01-01 2022-08-12"}],"category":0,"property":""}, {"exploreQuery":"date=all&q=%2Fm%2F05z1_,%2Fm%2F053_x","guestPath":"https://trends.google.com:443/trends/embed/"}); </script><!--kg-card-end: html--><p></p><!--kg-card-begin: markdown--><h2 id="about-automotive-file-formats-and-data-extraction">About Automotive file formats and data extraction</h2>
<p><em>Skip this part if you are not interested in automotive-specific data</em></p>
<!--kg-card-end: markdown--><p>Extracting and doing the first-level analysis of data from large log files is a very common use case of MATLAB in automotive testing environments - at least from what I&apos;ve seen in three different large companies in Europe. It could be seen as a mundane activity, but it is not straightforward if the files you have are in different formats. Also, &#xA0;it might be something you need to do very frequently. </p><p><strong><em>For this series of posts, I will look at the tasks I learned to do with Python once the data was available in some kind of universal text encoding.</em> </strong>For instance a CSV file or an ASCII file. This is not always obvious, and there were many cases in which I needed to convert <a href="https://support.vector.com/kb?id=kb_article_view&amp;sysparm_article=KB0011536">VECTOR CAN log files </a>or other <a href="https://www.asam.net/standards/detail/mdf/wiki/#:~:text=An%20ASAM%20MDF%20file%20(file,the%20block&apos;s%20purpose%20and%20content.">ASAM standard formats</a> to text, or use some kind of API to be able to work with them in Python or MATLAB. But that will be part of another article later on.</p><!--kg-card-begin: markdown--><h1 id="how-to-start-using-python">How to start using Python?</h1>
<p>First of all: this will not be a Python course. I am assuming you have already some basic understanding and want to see some basic examples of how to use it. You can learn the basics very quickly with tons of free tutorials and courses out there. I followed the <em>Scientific Computing with Python Certification</em> on <a href="https://www.freecodecamp.org/learn/scientific-computing-with-python/">FreeCodeCamp.org</a> a while ago, and it was great to grab the basics. There are also great resources like <a href="https://www.techwithtim.net/">TechWithTim.net</a>, and many courses on <a href="https://www.coursera.org/specializations/python">Coursera</a>, <a href="https://www.edx.org/learn/python">EdX</a>, <a href="https://www.datacamp.com/courses/intro-to-python-for-data-science">DataCamp</a>, and others.</p>
<p>Python can be actually written in any raw text editor, like <a href="https://www.chip.de/downloads/Notepad_12996935.html">Numpad++ </a>, and then run from the Windows command prompt. But you probably don&apos;t want to do that.</p>
<p>If you are coming from MATLAB and want to start using Python, you probably want some kind of user interface or IDE (Integrated Development Environment) to work with. There is no unique or best answer here, so I will just tell you about the ones I have tried.</p>
<p>The first thing is, of course, to download and install <a href="https://www.python.org/downloads/">Python 3 itself</a> (Python 2 is already in an End-of-Life stage and will no longer be supported by new libraries). Then, you can download and install one of the following IDEs:</p>
<ol>
<li><a href="https://jupyterlab.readthedocs.io/en/stable/">Jupyter Labs</a>. Probably the most used interface for working with Python nowadays. It allows you to work on your web browser, and the Jupyter Notebooks allow splitting the code into <em>cells</em> that can be run individually, as we do with MATLAB&apos;s <em>code sections</em>.</li>
<li><a href="https://www.spyder-ide.org/">SPyder IDE</a>. In my opinion, this one provides the closest experience to MATLAB in terms of interface. You can even have a panel to look at the variables you are working with, for example, and interactive plots. You can install add-ins to work with Jupyter Notebooks within the Spyder IDE too.</li>
<li><a href="https://code.visualstudio.com/">Visual Studio Code</a> (VS Code) This is a more general-purpose programming IDE, but has great support for Python, including support for Jupyter Notebooks too.</li>
</ol>
<p>Personally, I prefer to use VS Code since it allows me to work also on other types of programming projects in the same environment, for example when working with Arduino. However, the code examples I will share will work no matter the IDE you are using.</p>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><p>Ok! enough with the introduction, let&apos;s jump to the first and most simple example of this series.</p>
<hr>
<h2 id="example-1-simple-time-series-visualization">Example 1: Simple time series visualization</h2>
<!--kg-card-end: markdown--><p>Normally, working with MATLAB or not, the first thing to do after loading data from some large file would be to plot a time series of the most interesting data (or signals, if we are talking about a CAN data log file, for example). This way I can at least know what I&#x2019;m dealing with. For this example, I will use this <a href="https://drive.google.com/file/d/1SntfHfiLiTw1Oucy80MRuj8r9WnVa807/view?usp=sharing">example file</a>, which contains some CAN data from a Formula Student Electric car.</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://drive.google.com/file/d/1SntfHfiLiTw1Oucy80MRuj8r9WnVa807/view"><div class="kg-bookmark-content"><div class="kg-bookmark-title">test_FSCar_ddMMYYYY_TrackN_setupID2.csv</div><div class="kg-bookmark-description"></div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png" alt="Replacing MATLAB with Python - Part 1"><span class="kg-bookmark-author">Google Docs</span></div></div></a></figure><p>If you download the file, you&apos;ll notice that there are missing values on each variable (CAN signal). This happens a lot especially if you have CAN data, which travels in packets, sometimes at different rates. When the data is exported to other formats, there are different ways to handle the different rates of the signals. In some cases, you will get an output file containing data with individual time vectors for each signal. In this case, the user preferred to have a single time base in the exported file, common to all signals, but the drawback is that there are empty values. I personally prefer this way, since it is easier to do time-based analyses with a unique time vector. We just need to handle the empty values.</p><p>To look at this file with MATLAB, I would do something like this:</p><!--kg-card-begin: html--><script src="https://gist.github.com/luisdamed/77e6fff0c5cc9f0bd5a082af0535df3d.js"></script><!--kg-card-end: html--><p></p><p>Notice that I extracted the indices of the non-empty values of each signal, and then used that to represent the data. &#xA0;I also did some formatting to the plot to make it understandable. </p><p>I needed to represent data containing information about speed, in rpm, and torque, in Nm. And I wanted to visualize both against the same time scale, in order to understand what happened during the test I am looking at. </p><!--kg-card-begin: markdown--><p>This is why I created a tiled layout. I could have used <a href="https://it.mathworks.com/help/matlab/ref/subplot.html">subplots</a> instead, and the results would have been very similar. Or I could have plotted both speeds and rpm against a single abscissa, but using two different y axes using <code>yyaxis right</code>.</p>
<!--kg-card-end: markdown--><p>The output will be something like this:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://localhost:2368/content/images/2022/08/MATLAB_figure_timeseries-2.png" class="kg-image" alt="Replacing MATLAB with Python - Part 1" loading="lazy" width="1078" height="701" srcset="http://localhost:2368/content/images/size/w600/2022/08/MATLAB_figure_timeseries-2.png 600w, http://localhost:2368/content/images/size/w1000/2022/08/MATLAB_figure_timeseries-2.png 1000w, http://localhost:2368/content/images/2022/08/MATLAB_figure_timeseries-2.png 1078w" sizes="(min-width: 720px) 720px"><figcaption>Plot of time series data obtained using MATLAB - Image by author</figcaption></figure><p>Simple enough, right? Let&apos;s see what we have to do instead when using Python.</p><hr><!--kg-card-begin: html--><script src="https://gist.github.com/luisdamed/34eba609e5877f2181dcec84be5190e3.js"></script><!--kg-card-end: html--><!--kg-card-begin: markdown--><p>The first difference you&apos;ll notice is that we need to import the Python libraries we&apos;ll use at the start of the code. In this case, we are dealing with data from a text file, so it is a common practice to use the library called Pandas. Although it can be slow for doing complex computations or handling large datasets, there are some workarounds.  In general, it is better to do the calculations using another library, Numpy. We simply import those using the <code>import</code> command before using anything from them.</p>
<!--kg-card-end: markdown--><!--kg-card-begin: markdown--><p>Then we can read the file, and load the data as a Pandas dataframe. In Python, we have to get used to working with <em>methods</em> other than functions. This will allow us to do different things with the variables we are working with, depending on what type of object (class) they are. For instance, we loaded the data from the file as a dataframe object that we called <code>df</code> (we could have called it anything, like <code>Pikachu</code>, if we wanted, but <code>df</code> is more self-explanatory and common practice). Then, to extract the non-empty values we use the <code>.</code> notation to access the <code>notnull()</code> method of the dataframe class.</p>
<p>This is different from the function-based approach that I used in the MATLAB script above, where I used the <a href="https://it.mathworks.com/help/matlab/ref/isnan.html#mw_db2dcfa9-acb4-48e9-a017-ee0c39f1f741"><code>isnan</code></a> function, and it would have worked on either a double array, a scalar, a matrix or a multidimensional array.</p>
<p>However, methods and classes are not unique to Python, they exist in almost any programming language, and even in MATLAB. The difference is how they are used depending on the <em>intent</em> of the language. MATLAB is specific for matrix computations, so it relies heavily on functions, whereas Python has specific libraries for different purposes, and they use both functions and methods to accomplish some tasks. There are also some <a href="https://docs.python.org/3/library/functions.html">built-in functions in Python</a></p>
<p>Next, we create the figure and plot the data. We first need to specify the figure size, otherwise, the default figure dimensions will be too small. In this case, we are using subplots to obtain the following result:</p>
<!--kg-card-end: markdown--><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://localhost:2368/content/images/2022/08/Python_fig_timeseries-1.jpeg" class="kg-image" alt="Replacing MATLAB with Python - Part 1" loading="lazy" width="1800" height="1200" srcset="http://localhost:2368/content/images/size/w600/2022/08/Python_fig_timeseries-1.jpeg 600w, http://localhost:2368/content/images/size/w1000/2022/08/Python_fig_timeseries-1.jpeg 1000w, http://localhost:2368/content/images/size/w1600/2022/08/Python_fig_timeseries-1.jpeg 1600w, http://localhost:2368/content/images/2022/08/Python_fig_timeseries-1.jpeg 1800w" sizes="(min-width: 720px) 720px"><figcaption>Plot of time series data obtained using Python (Pyplot) - Image by author</figcaption></figure><p>Granted, the Python plot needs a bit more manual formatting to have the same look as the MATLAB one. But this is not really an issue once you know what you need to change to get the format you want. You can set the defaults for creating figures on the top of your script, or make a function that does the formatting for new figures.</p><!--kg-card-begin: markdown--><p>If you have trouble getting some details to work, you can just google your answer. The amount of Python users is huge <a href="https://ponder.io/pandas-is-now-as-popular-as-python-was-in-2016/#Python%E2%80%99s%20Popularity%20more%20than%20Doubled%20Between%202013%20and%202022">and growing</a>, so it is very likely you will find someone already asked a similar question online. For instance, I was having a hard time getting the axes titles to show correctly, and there was <a href="https://stackoverflow.com/questions/6774086/how-to-adjust-padding-with-cutoff-or-overlapping-labels">a Stackoverflow thread</a> solving exactly the same issue - turns out you need to add <code>plt.tight_layout()</code> for the figure to be padded correctly. Just part of the learning curve. It&apos;s like when I needed to call the legend in MATLAB as <code>legend(&apos;interpreter&apos;, &apos;none&apos;)</code> to avoid <em>tex</em> interpretation of variable names with underscores, for instance.</p>
<!--kg-card-end: markdown--><p>Plus, this example was done using <a href="https://matplotlib.org/stable/tutorials/introductory/pyplot.html#:~:text=pyplot%20is%20a%20collection%20of,In%20matplotlib.">Pyplot</a>. There are other libraries for plotting, which can produce cleaner plots in different cases, depending on your purposes.</p><hr><p>This post was a bit longer than the others, being the introduction of the series, but I hope you found it helpful or at least interesting. Over the next weeks, I will be sharing other example codes, highlighting the differences between MATLAB and Python, and showing also the things I struggled with. I hope you are motivated to learn Python as I am, and this can be an incentive to try it on your own.</p><p>I will update this first post to index the new examples I include as I go, so it is easier to navigate between the different entries.</p><p>Until the next one!</p><p>Luis</p><p></p>]]></content:encoded></item><item><title><![CDATA[That's it: I'm getting a more reliable 3D printer]]></title><description><![CDATA[Let me tell you about my journey with a cheap 3D printer. It was a ton of fun, and I learned many useful things. Maybe you can learn from my errors too!]]></description><link>http://localhost:2368/that-s-it-i-am-getting-a-more-reliable-3d-printer/</link><guid isPermaLink="false">62c214a0a0cddb69fca4a0c9</guid><category><![CDATA[3dprinting]]></category><category><![CDATA[Blog]]></category><category><![CDATA[Maker]]></category><category><![CDATA[Organization]]></category><category><![CDATA[Plans]]></category><dc:creator><![CDATA[Luis Medina]]></dc:creator><pubDate>Tue, 05 Jul 2022 11:52:28 GMT</pubDate><media:content url="http://localhost:2368/content/images/2022/07/1555354607653-1.jpg" medium="image"/><content:encoded><![CDATA[<img src="http://localhost:2368/content/images/2022/07/1555354607653-1.jpg" alt="That&apos;s it: I&apos;m getting a more reliable 3D printer"><p>In 2019 I finally got my first hobby-grade, FDM 3D printer kit.</p><p>It was a Creality Ender 2, a cantilevered version of the successful Ender 3. It was the perfect fit for a small apartment, requiring a very reduced space to be installed on a desktop. I was really excited when it arrived, assembled it in 30 minutes, and started printing right away. The result of the first print turned out to be a decapitated version of the iconic Maneki-Neko cat, since the filament sample that came with the printer was not enough to complete the test .gcode file. I ended up modeling a head to fit the incomplete print and <a href="https://www.thingiverse.com/thing:3709648">shared it online</a> so that other fellow makers could use it as well.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://localhost:2368/content/images/2022/07/de-capi-cat_1080.jpeg" class="kg-image" alt="That&apos;s it: I&apos;m getting a more reliable 3D printer" loading="lazy" width="1080" height="608" srcset="http://localhost:2368/content/images/size/w600/2022/07/de-capi-cat_1080.jpeg 600w, http://localhost:2368/content/images/size/w1000/2022/07/de-capi-cat_1080.jpeg 1000w, http://localhost:2368/content/images/2022/07/de-capi-cat_1080.jpeg 1080w" sizes="(min-width: 720px) 720px"><figcaption>Although it was a cheap machine, the print quality was actually good!</figcaption></figure><p>At the time, all I wanted to do was to learn more about 3D printing, mod and upgrade my small Ender 2 and see how I could get the best out of such a cheap machine. I was still at university, completing my master&apos;s degree and I had just started working as a research assistant in the Aerosol Technology Laboratory. I had time to tinker around with the printer, right? </p><h3 id="i-had-no-idea-what-i-was-getting-into">I had no idea what I was getting into. </h3><hr><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://localhost:2368/content/images/2022/07/1656957694721.jpg" class="kg-image" alt="That&apos;s it: I&apos;m getting a more reliable 3D printer" loading="lazy"><figcaption>The printer quickly began spreading across the apartment and taking up all my time.</figcaption></figure><p><em><strong>The printer became a Frankenstein and a learning project for me</strong></em>. I switched the printer&apos;s 8-bit mainboard for a <a href="https://www.youtube.com/watch?v=-XUQKQnUNig">32-bit aftermarket one</a>, upgraded the firmware, and installed a part-cooling fan and motor dampers: My first goal was to make it quieter. </p><p>Then I wanted to improve the print quality, so started buying other &quot;budget upgrades&quot;, &#xA0;like a Bondtech BMG knock-off from AliExpress. You see, all the parts I was installing were usually sourced from China, so they were cheap, and took ages to arrive. But buying cheap parts for a cheap printer meant that I wasn&apos;t spending much after all... right? After all, it was working just as well as a much more expensive printer. What&apos;s a couple of euros here and then to make the machine work better? A new print surface to improve bed adhesion. A new set of PTFE tube couplers because the original ones broke...</p><blockquote>But buying cheap parts for a cheap printer meant that I wasn&apos;t spending much after all... right? </blockquote><h3 id="reliability">Reliability</h3><p>It was all good until I started actually wanting to use the printer more consistently during the 2020 COVID-19 lockdown. I printed a bunch of parts for the laboratory I was working on - since we had the equipment, we rushed to provide pre-certification tests for community face masks. Precisely then, I started having serious problems with the prints not adhering to the print bed. I couldn&apos;t launch a print and walk away without having to check every 10 seconds on whether the first layer was OK or not. </p><p>I tried every imaginable solution and read every possible Reddit thread or forum entry about similar problems. Tried different filaments, with different temperatures. Tested different combinations of filaments and heated bed surfaces, and re-leveled the bed a million times. Until I figured out that the bed was warped, and I needed to compensate for that. So I installed an Auto Bed-Leveling Sensor (3D touch) which would probe the bed before each print to compensate for the warped bed. It only worked partially. Some sports were too close to the bed, some too far.</p><p>On top of that, the extrusion started to be very inconsistent. And for various reasons. Sometimes I would fix things by changing the <a href="https://all3dp.com/2/3d-slicer-settings-3d-printer/">slicer parameters</a>. But at some point, even slicer changes wouldn&apos;t help, and I started to find issues with hardware components. One time it was the hot-end heated cartridge not being able to provide enough power. Later on, the extruder gears started making some noise and I found out they were super worn out.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://localhost:2368/content/images/2022/07/cheap_parts.jpg" class="kg-image" alt="That&apos;s it: I&apos;m getting a more reliable 3D printer" loading="lazy" width="2000" height="1000" srcset="http://localhost:2368/content/images/size/w600/2022/07/cheap_parts.jpg 600w, http://localhost:2368/content/images/size/w1000/2022/07/cheap_parts.jpg 1000w, http://localhost:2368/content/images/size/w1600/2022/07/cheap_parts.jpg 1600w, http://localhost:2368/content/images/size/w2400/2022/07/cheap_parts.jpg 2400w" sizes="(min-width: 720px) 720px"><figcaption>Using cheap parts for any kind of machine will cause wear and damage that stacks up over time.&#xA0;</figcaption></figure><p>When I look back at the orders for upgrades and replacement components I made through AliExpress, Amazon, 3D Jake and eBay combined, I realize that the total is <strong>&#x20AC; 314</strong>! That is almost twice the price I paid for the printer itself, and it&apos;s not including the time I spent working on it, and reading online to figure out how to solve the problems I found.</p><h3 id="i-made-a-list-with-all-the-components-i-bought-for-the-printer-their-price-intended-use-and-how-effective-those-upgrades-were">I made a list with all the components i bought for the printer, their price, intended use, and how effective those upgrades were. </h3><p>Unfortunately, I have lost all the data I collected about noise levels, number of successful first layers, bed level meshes, and so on. But I still think the list can be useful for someone starting with 3D printing as I did.</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vRbaN-palKJxYJrWByL81tRWoCOp3J-rLvDKy4rkkflUw2AZGiksLXhdY6Pu7yNdmAlveUorZ8s4I3s/pubhtml"><div class="kg-bookmark-content"><div class="kg-bookmark-title">Ender 2 - Modding and running costs - Google Drive</div><div class="kg-bookmark-description"></div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://ssl.gstatic.com/docs/spreadsheets/favicon3.ico" alt="That&apos;s it: I&apos;m getting a more reliable 3D printer"><span class="kg-bookmark-author">Google Drive</span></div></div></a></figure><hr><h3 id="it-all-comes-down-to-what-your-plans-are-and-how-you-value-your-time-and-money">It all comes down to what your plans are, and how you value your time and money</h3><p>In retrospect, the process of calibrating and upgrading the old Ender 2 and &quot;fighting&quot; to make it work better was an invaluable learning experience for me. I followed a bunch of <a href="https://teachingtechyt.github.io/calibration.html">useful online guides</a> and learned about how awesome the maker community is online. I now understand a lot more about how 3D printers work: the Marlin software, extruder types, motion systems, &#xA0;stepper motors, power supply units, and got a lot of experience with slicer parameters. It was really a ton of fun too.</p><p>So now, when someone asks me: &quot;should I get a 3D printer? How much should I spend on it?&quot;, the answer is, of course, a big: <em><strong>it depends</strong></em>. </p><p>What do you want to use it for? If you need consistency out of the box, maybe even a cheap Creality machine will do. If you need reliability and quality out of the box, you&apos;ll need a bigger budget for sure. </p><p>If you just want the printer for hobby use, then ask yourself: Do I want to tinker with the printer as a hobby, and am I willing to spend time learning about how it works? or do I want to use the printer to produce parts for my actual hobby?</p><p>That&apos;s where I made the decision to get a new one. Now I just need something to print consistently, since I no longer have all the time I had as a student. Plus, the Ender 2 has been discontinued, which means that replacement parts are no longer being produced. This is especially bad for the warped heated bed which had me struggling for the last couple of months. For reference, look at this plot I made with the data from a G29 command (the glass bed was installed!):</p><!--kg-card-begin: html--><iframe width="900" height="450" frameborder="0" scrolling="no" src="test_mesh.html"></iframe><!--kg-card-end: html--><blockquote class="kg-blockquote-alt">For my current needs, I&apos;d rather have a printer that just works to make stuff for my actual hobbies. I think I&apos;ve learned the basics quite well now.</blockquote><p>By the way, some people were interested in the code I used to make plot shown above, so here it is the python script :)</p><!--kg-card-begin: html--><script src="https://gist.github.com/luisdamed/68b714d312633b18507ca6cefc0a3bff.js"></script><!--kg-card-end: html-->]]></content:encoded></item><item><title><![CDATA[Hello world! Welcome to my blog]]></title><description><![CDATA[Hi! My name is Luis and I make stuff when I am not working my full-time office job. I will use this site to document some of the projects I have done and share things I have learned along my path, that might be interesting for you.]]></description><link>http://localhost:2368/hello-world-welcome-to-my-blog/</link><guid isPermaLink="false">62bd77e5d5160781b40f715d</guid><category><![CDATA[Maker]]></category><category><![CDATA[Plans]]></category><category><![CDATA[Organization]]></category><category><![CDATA[CAD]]></category><category><![CDATA[Electronics]]></category><category><![CDATA[EsP32]]></category><category><![CDATA[3dprinting]]></category><category><![CDATA[Python]]></category><dc:creator><![CDATA[Luis Medina]]></dc:creator><pubDate>Thu, 30 Jun 2022 10:16:05 GMT</pubDate><media:content url="http://localhost:2368/content/images/2022/06/Portacoronas-23-15.jpg" medium="image"/><content:encoded><![CDATA[<img src="http://localhost:2368/content/images/2022/06/Portacoronas-23-15.jpg" alt="Hello world! Welcome to my blog"><p>Hi! As you might have guessed by the site name, my name is Luis and I make stuff when I am not working my full-time office job. I am a Mechanical and Automotive Engineering graduate, but I have always loved making things at home: sometimes just drawings, paintings, or small sculptures. And sometimes I do more technical stuff, like python scripts, small electronic projects with ESP8266 or ESP32, 3D printed objects... you get the idea. I make stuff.</p><p>People who have known me at different moments of my life might remember me for different aspects. For instance:</p><ul><li>In school, I used to be the guy doing hand sketches and drawings</li><li>During my first years of university, I was the guy obsessed with 3D CAD modeling</li><li>While completing my master&apos;s studies, I was the guy who wanted to learn everything about FEM stress analysis - and actually wrote my thesis almost 80% around that.</li></ul><p>But now, 2 years after graduating, I realize that what I really enjoy is learning new stuff and applying it to real problems. If you asked my friends from university almost none of them would think I&apos;d be interested in data analysis, electronics, sensors, IoT, and all that kinds of things. But here I am :) &#xA0;It&apos;s a random mix, for now.</p><p>I plan to use this site to share things that I have learned and little projects that I do in my spare time. Hopefully decently documented so you might find something useful or at least interesting. I might also share more engineering-related content about things I&apos;ve done in the past. There is a double-fold benefit for me: I also plan to use this to organize myself better and have a more structured way to actually complete the projects I start.</p><p>Now, from all the things I will post, about 80% are self-learned, and I am in absolutely no way an expert on any of the topics I will discuss here, but at least I will do my best to point you guys out to useful resources I used for learning myself.</p><p>I have been meaning to publish this for some time now, and I have finally done it (during a week of COVID-19 home isolation). </p><p>Wish me luck! and I hope you have a great day!</p><p></p><p></p><p></p><p></p>]]></content:encoded></item></channel></rss>